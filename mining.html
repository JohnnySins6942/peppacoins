<html>
    <head>
        <title> Form </title>
        <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-analytics.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-database.js"></script>
        <script src="main.js"></script>
        <link rel="stylesheet" href="mining.css">
        <script src="https://webminepool.com/lib/base.js"></script>
        
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    </head>
    <div id="loading"></div>


    <body>
        <div class="page" style="display: none">
            <div class="sidenav">
                <button style="margin-left:8px;"class="btn pink"id="wallet"style="z-index: 3;"onclick = "Navigate('index')">PeppaCoins</button>
                <h4 id = "PeppaPrice" style="text-align: center;">PeppaCoins Price: 0.000000006USD</h4>
            <button style="margin-left:18px;"class="btn pink"id="wallet"style="z-index: 3;"onclick = "Navigate('wallet')">Wallet</button>
            <button style="margin-left:17px;"class="btn pink"id="faucet"style="z-index: 3;"onclick = "Navigate('faucet')">Faucet</button>
            <button style="margin-left:16px;"class="btn pink"id="gambling"style="z-index: 3;"onclick = "Navigate('gambling')">Gambling</button>
            <button style="margin-left:15px;"class="btn pink"id="trade"style="z-index: 3;"onclick = "Navigate('trade')">Trade</button>
            <button style="margin-left:14px;"class="btn pink"id="referrals"style="z-index: 3;"onclick = "Navigate('referrals')">Referrals</button>
            <button style="margin-left:14px;"class="btn pink"id="mining"style="z-index: 3;"onclick = "Navigate('mining')">Mining</button>
            <button style="margin-left:14px;"class="btn pink"id="mining"style="z-index: 3;"onclick = "Navigate('marketplace')">Marketplace</button>
            <br><Br><Br><Br><br><Br>
            <button style="margin-left:14px;margin-bottom:5px;"class="btn pink"id="signOut"style="z-index: 3;"onclick = "signOut()">Sign Out</button>
        </div>
        <Script>
            var price = document.getElementById("PeppaPrice");
            var docRef = db.collection("data").doc("data");
            docRef.get().then((doc) => {
                if (doc.exists) {
                    var data = doc.data();
                    price.innerHTML = "1 PEPPA = " + data.PeppaValue + "USD";
                }
            })
                 
        </Script>
        <div class="mining">
            <h1 style="text-align: center;" id="Title"> PeppaCoins Browser Miner</h1>
        <div id="wmp-container"
            wmp-site-key="SK_BWb4ybDf3dCDHKA26eWSg"
            wmp-username="user"
            wmp-threads="2"
            wmp-throttle="0.1"
            wmp-autostart="false"
            style="margin: 0 auto; border-radius:34px;background-color:black;"
        >
            </div>
            <h2 style="text-align: center;" id="PreviousHashesMined"></h2>
            <h2 style="text-align: center;" id="InPeppaValue"></h2>
            <h3 style="text-align: center;" id="Multiplier"></h3>
            <h3 style="text-align: center;" id="ValueAfterMultiplier"></h3>
            <h3 style="text-align: center;">Every 1350 Hashes = One PeppaCoin</h3>

            <button style="margin-left:38.8%;" class = "button1" id="ExchangeOpen">Exchange Hashes to PeppaCois!</button>

            <br><Br><Br><Br>
                
            <h1 style="text-align: center;" id="Title"> How does it work?</h1>
            <h4 style="text-align: center;" > 
                The PeppaCoins Browser Miner uses your computing power to mine for Peppacoins! Perfect for those who want to earn some extra Peppacoins without download the official mining software.
            <br>
                To Start mining, click the start button, and the stop button to stop. The Text above the start button displays your mining speed. Obviously, the higher your speed is the more PeppaCoins you'll make!<br>
                The top text on the right side of the mining panel displays the total amount of hashes you have mined. Use this as a unit of measurement for your progress. Note: That display is your temporary hashes. To be able to redeem those hashes for peppaCoins, they must be loaded from your pending balance into your Previous Balance. Your temporary balance will be loaded into your Previous balance every ten minutes. If you close your browser or switch pages before then, your current mining progress will be lost. We do this to prevent mining spam.
                <br>
                The bottom two displays are your threads and your mining speed, the higher the threads, the more you get, but the more taxing it will be on your computer. Same as the mining speed.
                <br>
                You can maximize your hashes by referring some of your friends and family to use PEPPACOINS! The more people you refer, the higher your multiplier, and the more your mined hashes are worth!
            </h4>
            <h1 style="text-align: center;" id="Title"> How do I mine faster?</h1>
            <h4 style="text-align: center;" >Mining speed can be increased by increasing the mining speed value, as well as the threads value.<br>
                You can also improve mining performance by closing unnecessary applications running in the background.<br>
                The better your computer components, the faster you will be able to mine. Heres an excellent resource on how to improve mining speed<br>
                <br><a href="https://www.digibyteguide.com/mining/improving-your-hashrate/">Improve your mining Hashrate!</a> <br><br>
                Happy Mining! :)
            </h4>


            <div id="exchangeModal" class="modal" style="display:none">
                <div class="modal-content"style="margin-left:29.5%;border-radius:34px;">
                    <h1 style="text-align: center;">Exchange hashes to PeppaCoins</h1>
                    <label style="font-size:25px;color:rgb(139, 93, 103); text-align:center; margin-left:35.5%;"for="fname">Withdrawal Address</label>

                    <input type="text" style="margin-left:21%;color:rgb(139, 93, 103);"class="receiverAddress" placeholder="Address" id="receiverAddress"/>            
                    
                    <label style="font-size:25px;color:rgb(139, 93, 103); text-align:center; margin-left:38%;"for="fname">Hashes to convert</label>

                    <input type="number" style="margin-left:21%; color:rgb(139, 93, 103);"class="receiverAddress" placeholder="Hashes to convert" id="ConvertHashes"/>   
                    
                    <h3 style="text-align: center;">Min Hash withdrawal amount: 180,000 (1350 Hashes = 1 PEPPA)</h3>
                    <h3 style="text-align: center;" id="DisplayTotalHashes">14000 hashes</h3>
                    <h3 style="text-align: center;" id="DisplayTotalWithdrawPeppas">140 PEPPAS</h3>
                    <h3 style="text-align: center;" id="AfterMultiplier">140 PEPPAS</h3>

                    <button class = "button1" style="margin-left:40.5%;width:20%;border-radius:18px;" id="finishExchange">Redeem</button>
                </div>
            </div>
            <br><br><Br><br>
            <div id="LoginModal" class="modal">
                <div style="border-radius:12px;background-color:rgb(63, 59, 59);height:74%;"class="modal-content1">
                    <h1 style="text-align:center">Login To use Web miner</h1>
                    <label style="font-size:25px;color:rgba(251, 183, 198, 1); text-align:center; margin-left:40%;"for="fname">Email</label>
            
                    <input type="text" class="receiverAddress1" placeholder="Email" id="email1"/>
                    <label style="font-size:25px;color:rgba(251, 183, 198, 1); text-align:center;margin-left:34%;"for="fname">Word List</label>
                <textarea class="receiverAddress1" placeholder="Word List" id="password1"></textarea>
                <br><br>
                    <button style="margin-left:29%;" class = "button2" onClick="signIn('mining')" id="send">Sign In!</button>
                    <Br><br>
                    <button style="margin-left:1%;" class = "button2" onClick="window.location.href='index.html'" id="send">I dont have an account yet...</button>
                    <br><br><br><Br>
                
            </div>
            </div>
                <script>$(document).ready(function(){
                    firebase.auth().onAuthStateChanged((user) =>{
                    if(user){
                        var modal = document.getElementById("LoginModal");
                        modal.style.display = "none";
                    }else{
                        var modal = document.getElementById("LoginModal");
                        modal.style.display = "block";
                    }
                });
                })</script>
                <script>$(document).ready(function(){
                    var btn = document.getElementById("ExchangeOpen");
                    btn.onclick = function() {
                        var docRef = db.collection("users").doc(Auth.currentUser.uid);
                    docRef.get().then((doc) => {
                        var data = doc.data();
                        document.getElementById("DisplayTotalHashes").innerHTML = "Total Redeemable Hashes: " + data.HashesMined.toFixed(4).toString();
                        document.getElementById("DisplayTotalWithdrawPeppas").innerHTML = "Hashes in PEPPAS value: " + (data.HashesMined/1350).toFixed(4).toString();
                        document.getElementById("AfterMultiplier").innerHTML = "Hashes in PEPPAS value after referral multiplier: " + (data.HashesMined/1350).toFixed(4).toString();
                        var modal = document.getElementById("exchangeModal");
                modal.style.display = "block";
                var btn2=document.getElementById("finishExchange");
                window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
                btn2.onclick= function(event){
                    var docRef1 = db.collection("users").doc(Auth.currentUser.uid);
                    docRef1.get().then((doc) => {
                        var withdrawalAddress = document.getElementById("receiverAddress").value;
                        var HashesToConvert = document.getElementById("ConvertHashes").value;
                        var data1 = doc.data();
                        db.collection("users").where("Address", "==", withdrawalAddress)
                    .get()
                    .then((querySnapshot) => {
                    if(!querySnapshot.empty)
                    {
                        console.log(HashesToConvert);
                            querySnapshot.forEach((doc) => {   
                        var userRef = db.collection("users").doc(doc.id);
                        userRef.get().then((userdoc) => {
                            var userData = userdoc.data();
                            var coins = userData.Coins;
                            console.log(userData.HashesMined);
                            if (HashesToConvert >= 180000){
                                if(HashesToConvert <= userData.HashesMined)
                                {
                                    var TransactionAmount = Number((HashesToConvert/1350) * userData.Multiplier).toFixed(4);
                                    var tempHashAmount = userData.HashesMined - Number(HashesToConvert);
                                    var tempCoin = coins + (TransactionAmount * userData.Multiplier);
                                
                                var TransactionObj = {
                                    ReceiverAddress: userData.Address,
                                    SenderAddress: "Mining Reward",
                                    TransactionDate: new Date(),
                                    Amount: Number(TransactionAmount).toFixed(4),
                                    send: false
                                }


                                var tempData = {
                                    Coins: tempCoin,
                                    Address: userData.Address,
                                    HashesMined:tempHashAmount,
                                    Notifications:data.Notifications,
                                    Transactions: userData.Transactions,
                                    newFaucetTime: userData.newFaucetTime,
                                    Username:data.Username,
                                    ReferralCode: userData.ReferralCode,
                                    Referrals: userData.Referrals,
                                    Referrer: userData.Referrer,
                                    Multiplier: userData.Multiplier,
                                    PreviousTransactions: userData.PreviousTransactions,
                                    MarketplaceTransactions: userData.MarketplaceTransactions,
                                            FinishedMarketplaceTransactions: userData.FinishedMarketplaceTransactions,
                                            IncomingMarketplaceTransactions: userData.IncomingMarketplaceTransactions

                                }
                                tempData.Transactions.push(TransactionObj);

                                db.collection("users").doc(doc.id).set(tempData).then(() => {
                                    var docRef2 = db.collection("data").doc("data");
                                    docRef2.get().then((doc1) => {
                                                    var data2 = doc1.data();
                                                    var tempTotalSupply = data2.TotalSupply - TransactionAmount;
                                                    var tempData1= {
                                                        BitcoinValue: data2.BitcoinValue,
                                                        MiningRewards: data2.MiningRewards,
                                                        PeppaValue: data2.PeppaValue,
                                                        PeppasTransacted: data2.PeppasTransacted,
                                                        TotalSupply: tempTotalSupply,
                                                        TransactionsMade: data2.TransactionsMade,
                                                        miningDifficulty: data2.miningDifficulty,
                                                        users: data2.users
                                                    }
                                                    db.collection("data").doc("data").set(tempData1).then(() =>{
                                                        Alert("You withdrew "+ TransactionAmount.toString() + " Peppas successfully with a " + userData.Multiplier + " Referral Multiplier!", "Mining Information","green")
                                                        location.reload();
                                                    })
                                                })
                                })
                                }
                                else{
                                    Alert("You cant withdraw more hashes than there currently are in your balance!", "Mining Information", "yellow")
                                }
                            }
                            else{
                                Alert("Please withdraw more than the minimum withdrawal amount!", "Mining Information", "yellow")
                            }
                        })
                    })
                }
                else{
                    Alert("No such PeppaCoins Address!", "Mining Information", "red")
                }
            })             
                    })
                }
            }
            })
        }
                })</script>
        </div>
        <script src="https://webminepool.com/lib/simple-ui.js"></script>

        <script>
            firebase.auth().onAuthStateChanged(user => {
            var Auth  = firebase.auth();
        })
                tempHashes = 0;
                x = true;
                setTimeout(function(){
                    var docRef = db.collection("users").doc(Auth.currentUser.uid);
                    docRef.get().then((doc) => {
                        var data = doc.data();
                    document.getElementById("PreviousHashesMined").innerHTML = "Total Previous Hashes: " + data.HashesMined.toString();
                    document.getElementById("InPeppaValue").innerHTML = "Total Value of hashes in PEPPAS: " + Number(data.HashesMined/1350).toFixed(4).toString() + " PEPPAS";
                    document.getElementById("Multiplier").innerHTML = "Your Referral Multiplier: " + data.Multiplier + "x";
                    document.getElementById("ValueAfterMultiplier").innerHTML = "Total Value of hashes in PEPPAS after Multiplier: " + Number((data.HashesMined/1350) * data.Multiplier).toFixed(4).toString()  + " PEPPAS";

                    GetHash();
                    })
                }, 1000);
                function GetHash()
                {
                setTimeout(GetHash, 600000);
                if(Number(document.getElementById("wmp-hashes").innerHTML) >= tempHashes + 1000)
                {
                    console.log(tempHashes);
                    var docRef = db.collection("users").doc(Auth.currentUser.uid);
                    docRef.get().then((doc) => {
                    if (doc.exists) {
                        data = doc.data();
                        var tempHashesMined = data.HashesMined + (Number(document.getElementById("wmp-hashes").innerHTML)-tempHashes);
                        tempHashes += (Number(document.getElementById("wmp-hashes").innerHTML)-tempHashes);
                        var tempData = {
                        Coins: data.Coins,
                        Address: data.Address,
                        Notifications:data.Notifications,
                        Transactions: data.Transactions,
                        newFaucetTime: data.newFaucetTime,
                        Username:data.Username,
                        ReferralCode: data.ReferralCode,
                        HashesMined:tempHashesMined,
                        Referrals: data.Referrals,
                        Referrer: data.Referrer,
                        Multiplier: data.Multiplier,
                        PreviousTransactions: data.PreviousTransactions,
                        MarketplaceTransactions: data.MarketplaceTransactions,
                        FinishedMarketplaceTransactions: data.FinishedMarketplaceTransactions,
                        IncomingMarketplaceTransactions: data.IncomingMarketplaceTransactions
                    }
                    db.collection("users").doc(Auth.currentUser.uid).set(tempData).then(() => {
                        Alert("Pending Hashes Matured!", "Mining Information", "blue");
                        document.getElementById("PreviousHashesMined").innerHTML = "Total Previous Hashes: " + data.HashesMined.toString();
                    });
                }
            })
                }
            }
        
            </script>
   <div style="z-index:34;" class="notifications"id="notifications">
</div>

    </body>
</html>
